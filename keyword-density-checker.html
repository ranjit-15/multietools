<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Keyword Density Checker - Multietools</title>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
	<link rel="stylesheet" href="css/global.css">
	<style>
		*{box-sizing:border-box;margin:0;padding:0;}
		body{font-family:'Inter',system-ui,sans-serif;background:var(--bg);color:var(--text);min-height:100vh;padding:1.5rem;transition:background .3s,color .3s;}
		.wrap{max-width:960px;margin:0 auto;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-lg);box-shadow:var(--shadow-md);overflow:hidden;}
		header{padding:1.75rem;border-bottom:1px solid var(--border);background:var(--primary-glow);}
		h1{font-size:1.8rem;margin-bottom:.35rem;} .muted{color:var(--muted);}
		.back{display:inline-flex;align-items:center;gap:.5rem;color:var(--text);text-decoration:none;font-weight:700;margin-bottom:1rem;}
		main{padding:1.5rem;display:grid;gap:1.25rem;}
		.panel{background:var(--surface);border:1px solid var(--border-light);border-radius:var(--radius-md);padding:1.25rem;box-shadow:var(--shadow-xs);}
		textarea{width:100%;min-height:180px;border-radius:var(--radius-md);border:1px solid var(--border);background:var(--bg-alt);color:var(--text);padding:1rem;font-size:.9rem;font-family:'JetBrains Mono','Cascadia Code',monospace;resize:vertical;}
		input[type=text],input[type=url]{width:100%;padding:.65rem .9rem;border-radius:var(--radius-sm);border:1px solid var(--border);background:var(--bg-alt);color:var(--text);font-size:.9rem;}
		.row{display:flex;flex-wrap:wrap;gap:.75rem;align-items:center;margin-top:.75rem;}
		button{padding:.75rem 1.1rem;border-radius:var(--radius-sm);border:none;cursor:pointer;background:linear-gradient(135deg,var(--primary),var(--primary-light));color:#fff;font-weight:700;font-size:.9rem;box-shadow:var(--shadow-sm);transition:transform .15s ease,box-shadow .15s ease;}
		button:hover{transform:translateY(-1px);box-shadow:var(--shadow-md);}
		button.secondary{background:var(--bg-alt);color:var(--text);border:1px solid var(--border);}
		button.secondary:hover{background:var(--border-light);}
		.stat-row{display:flex;flex-wrap:wrap;gap:1rem;margin-bottom:1rem;}
		.stat-card{background:var(--bg-alt);border:1px solid var(--border);border-radius:var(--radius-sm);padding:.75rem 1rem;flex:1;min-width:120px;text-align:center;}
		.stat-val{font-size:1.6rem;font-weight:800;color:var(--primary);}
		.stat-label{font-size:.78rem;color:var(--muted);font-weight:600;margin-top:.15rem;}
		.result-section{margin-top:.75rem;}
		.result-section h3{font-size:1rem;font-weight:700;margin-bottom:.5rem;display:flex;align-items:center;gap:.5rem;}
		.kw-table{width:100%;border-collapse:collapse;font-size:.85rem;}
		.kw-table th,.kw-table td{padding:.5rem .75rem;border-bottom:1px solid var(--border);text-align:left;}
		.kw-table th{background:var(--bg-alt);font-weight:700;cursor:pointer;user-select:none;position:sticky;top:0;}
		.kw-table th:hover{color:var(--primary);}
		.kw-table tr:hover td{background:var(--bg-alt);}
		.bar{height:6px;border-radius:var(--radius-full);background:var(--border);overflow:hidden;min-width:60px;}
		.bar-fill{height:100%;border-radius:var(--radius-full);background:var(--primary);transition:width .3s;}
		.table-wrap{max-height:350px;overflow:auto;border:1px solid var(--border);border-radius:var(--radius-sm);}
		.badge{padding:.4rem .75rem;border-radius:var(--radius-full,999px);border:1px solid var(--border);background:var(--bg-alt);color:var(--muted);font-size:.85rem;}
		.toast{position:fixed;bottom:1.5rem;right:1.5rem;background:var(--primary);color:#fff;padding:.85rem 1.5rem;border-radius:var(--radius-sm);font-weight:600;box-shadow:var(--shadow-lg);transform:translateY(120%);opacity:0;transition:transform .35s var(--ease-bounce,.34 1.56 .64 1),opacity .3s;z-index:9999;pointer-events:none;}
		.toast.show{transform:translateY(0);opacity:1;}
	</style>
</head>
<body>
<div class="wrap">
	<header>
		<a class="back" href="tools.html"><i class="fas fa-arrow-left"></i> Back to Tools</a>
		<h1><i class="fas fa-search"></i> Keyword Density Checker</h1>
		<p class="muted">Analyze keyword frequency and density in any text content.</p>
	</header>
	<main>
		<div class="panel">
			<label style="font-weight:600;display:block;margin-bottom:.35rem;">Text Content</label>
			<textarea id="textInput" placeholder="Paste your article, blog post, or any text content here…"></textarea>
			<label style="font-weight:600;display:block;margin-top:.75rem;margin-bottom:.35rem;">Or enter a URL (optional — may be blocked by CORS)</label>
			<input type="url" id="urlInput" placeholder="https://example.com/article">
			<div class="row">
				<button onclick="analyze()"><i class="fas fa-chart-bar"></i> Analyze</button>
				<button class="secondary" onclick="fetchURL()"><i class="fas fa-globe"></i> Fetch URL</button>
				<button class="secondary" onclick="clearAll()"><i class="fas fa-times"></i> Clear</button>
			</div>
		</div>

		<!-- Stats -->
		<div class="stat-row" id="statsRow" style="display:none;">
			<div class="stat-card">
				<div class="stat-val" id="totalWords">0</div>
				<div class="stat-label">Total Words</div>
			</div>
			<div class="stat-card">
				<div class="stat-val" id="uniqueWords">0</div>
				<div class="stat-label">Unique Words</div>
			</div>
			<div class="stat-card">
				<div class="stat-val" id="totalSentences">0</div>
				<div class="stat-label">Sentences</div>
			</div>
		</div>

		<!-- Single keywords -->
		<div class="panel result-section" id="sec1" style="display:none;">
			<h3><i class="fas fa-font"></i> Top Single Keywords <span class="badge" id="badge1">20</span></h3>
			<div class="table-wrap"><table class="kw-table" id="table1"><thead><tr><th data-col="word" data-table="1">Keyword</th><th data-col="count" data-table="1">Count</th><th data-col="pct" data-table="1">Density</th><th>Bar</th></tr></thead><tbody></tbody></table></div>
		</div>

		<!-- 2-word phrases -->
		<div class="panel result-section" id="sec2" style="display:none;">
			<h3><i class="fas fa-layer-group"></i> Top 2-Word Phrases <span class="badge" id="badge2">10</span></h3>
			<div class="table-wrap"><table class="kw-table" id="table2"><thead><tr><th data-col="word" data-table="2">Phrase</th><th data-col="count" data-table="2">Count</th><th data-col="pct" data-table="2">Density</th><th>Bar</th></tr></thead><tbody></tbody></table></div>
		</div>

		<!-- 3-word phrases -->
		<div class="panel result-section" id="sec3" style="display:none;">
			<h3><i class="fas fa-stream"></i> Top 3-Word Phrases <span class="badge" id="badge3">10</span></h3>
			<div class="table-wrap"><table class="kw-table" id="table3"><thead><tr><th data-col="word" data-table="3">Phrase</th><th data-col="count" data-table="3">Count</th><th data-col="pct" data-table="3">Density</th><th>Bar</th></tr></thead><tbody></tbody></table></div>
		</div>
	</main>
</div>

<div class="toast" id="toast"></div>

<script>
function showToast(msg,ms=2200){
	const t=document.getElementById('toast');t.textContent=msg;t.classList.add('show');
	clearTimeout(t._tid);t._tid=setTimeout(()=>t.classList.remove('show'),ms);
}

const STOP_WORDS=new Set(['the','a','an','and','or','but','in','on','at','to','for','of','with','by','from','is','it','its','this','that','was','were','are','am','be','been','being','have','has','had','do','does','did','will','would','shall','should','may','might','can','could','not','no','nor','so','if','then','than','too','very','just','about','above','after','again','all','also','any','as','because','before','between','both','each','few','get','got','he','her','here','him','his','how','i','into','me','more','most','my','new','now','only','other','our','out','over','own','re','same','she','some','such','their','them','there','these','they','through','under','up','us','we','what','when','where','which','while','who','whom','why','you','your','said','like','one','two','three','four','five','even','much','many','well','back','still','way','take','come','go','make','made','use','used','using','first','s','t','ve','ll','d','m','don','doesn','didn','won','wouldn','couldn','shouldn','isn','aren','wasn','weren','hasn','haven','hadn']);

function getWords(text){
	return text.toLowerCase().replace(/[^a-z0-9\s'-]/g,' ').split(/\s+/).filter(w=>w.length>1);
}

function getNgrams(words,n){
	const grams=[];
	for(let i=0;i<=words.length-n;i++){
		const slice=words.slice(i,i+n);
		if(slice.some(w=>STOP_WORDS.has(w))) continue;
		grams.push(slice.join(' '));
	}
	return grams;
}

function countFreq(arr){
	const map={};
	arr.forEach(w=>{map[w]=(map[w]||0)+1;});
	return Object.entries(map).sort((a,b)=>b[1]-a[1]);
}

let sortState={1:{col:'count',asc:false},2:{col:'count',asc:false},3:{col:'count',asc:false}};
let tableData={1:[],2:[],3:[]};

function renderTable(tableNum,data,limit){
	tableData[tableNum]=data;
	const st=sortState[tableNum];
	const sorted=[...data].sort((a,b)=>{
		if(st.col==='word') return st.asc?a[0].localeCompare(b[0]):b[0].localeCompare(a[0]);
		if(st.col==='count') return st.asc?a[1]-b[1]:b[1]-a[1];
		return st.asc?a[2]-b[2]:b[2]-a[2];
	}).slice(0,limit);
	const maxCount=sorted.length?sorted[0][1]:1;
	const tbody=document.getElementById('table'+tableNum).querySelector('tbody');
	tbody.innerHTML=sorted.map(([word,count,pct])=>`<tr><td>${esc(word)}</td><td>${count}</td><td>${pct.toFixed(2)}%</td><td><div class="bar"><div class="bar-fill" style="width:${(count/maxCount*100).toFixed(1)}%"></div></div></td></tr>`).join('');
	document.getElementById('badge'+tableNum).textContent=sorted.length;
}

function analyze(){
	const text=document.getElementById('textInput').value.trim();
	if(!text){showToast('Please enter some text to analyze');return;}

	const allWords=getWords(text);
	const filteredWords=allWords.filter(w=>!STOP_WORDS.has(w));
	const totalWords=allWords.length;
	const sentences=(text.match(/[.!?]+/g)||[]).length||1;

	document.getElementById('totalWords').textContent=totalWords;
	document.getElementById('uniqueWords').textContent=new Set(filteredWords).size;
	document.getElementById('totalSentences').textContent=sentences;
	document.getElementById('statsRow').style.display='flex';

	// Single keywords
	const singles=countFreq(filteredWords).map(([w,c])=>[w,c,(c/totalWords)*100]);
	renderTable(1,singles,20);
	document.getElementById('sec1').style.display='block';

	// 2-word phrases
	const bigrams=countFreq(getNgrams(allWords,2)).filter(e=>e[1]>=2).map(([w,c])=>[w,c,(c/totalWords)*100]);
	renderTable(2,bigrams,10);
	document.getElementById('sec2').style.display='block';

	// 3-word phrases
	const trigrams=countFreq(getNgrams(allWords,3)).filter(e=>e[1]>=2).map(([w,c])=>[w,c,(c/totalWords)*100]);
	renderTable(3,trigrams,10);
	document.getElementById('sec3').style.display='block';

	showToast(`Analyzed ${totalWords} words!`);
}

/* Sortable headers */
document.querySelectorAll('.kw-table th[data-col]').forEach(th=>{
	th.addEventListener('click',()=>{
		const tableNum=parseInt(th.dataset.table);
		const col=th.dataset.col;
		const st=sortState[tableNum];
		if(st.col===col) st.asc=!st.asc;
		else{st.col=col;st.asc=col==='word';}
		const limit=tableNum===1?20:10;
		renderTable(tableNum,tableData[tableNum],limit);
	});
});

async function fetchURL(){
	const url=document.getElementById('urlInput').value.trim();
	if(!url){showToast('Please enter a URL');return;}
	try{
		showToast('Fetching…');
		const resp=await fetch(url);
		if(!resp.ok) throw new Error('HTTP '+resp.status);
		const html=await resp.text();
		const doc=new DOMParser().parseFromString(html,'text/html');
		// Strip scripts and styles
		doc.querySelectorAll('script,style,noscript').forEach(el=>el.remove());
		const text=doc.body?doc.body.innerText||doc.body.textContent:'';
		document.getElementById('textInput').value=text;
		showToast('Page content fetched — click Analyze');
	}catch(e){
		showToast('Fetch failed (CORS?): '+e.message);
	}
}

function clearAll(){
	document.getElementById('textInput').value='';
	document.getElementById('urlInput').value='';
	document.getElementById('statsRow').style.display='none';
	['sec1','sec2','sec3'].forEach(id=>document.getElementById(id).style.display='none');
	showToast('Cleared');
}

function esc(s){return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');}
</script>
<script src="js/global.js"></script>
</body>
</html>
