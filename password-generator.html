<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Password Generator - Multietools</title>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
	<link rel="stylesheet" href="css/global.css">
	<style>
		*{box-sizing:border-box;margin:0;padding:0;}
		body{font-family:'Inter',system-ui,sans-serif;background:var(--bg);color:var(--text);min-height:100vh;padding:1.5rem;transition:background .3s,color .3s;}
		.wrap{max-width:960px;margin:0 auto;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-lg);box-shadow:var(--shadow-md);overflow:hidden;}
		header{padding:1.75rem;border-bottom:1px solid var(--border);background:var(--primary-glow);}
		h1{font-size:1.8rem;margin-bottom:.35rem;} .muted{color:var(--muted);}
		.back{display:inline-flex;align-items:center;gap:.5rem;color:var(--text);text-decoration:none;font-weight:700;margin-bottom:1rem;}
		main{padding:1.5rem;display:grid;gap:1.25rem;}
		.panel{background:var(--surface);border:1px solid var(--border-light);border-radius:var(--radius-md);padding:1.25rem;box-shadow:var(--shadow-xs);}
		textarea{width:100%;min-height:180px;border-radius:var(--radius-md);border:1px solid var(--border);background:var(--bg-alt);color:var(--text);padding:1rem;font-size:.9rem;font-family:'JetBrains Mono','Cascadia Code',monospace;resize:vertical;}
		.row{display:flex;flex-wrap:wrap;gap:.75rem;align-items:center;margin-top:.75rem;}
		.slider-row{display:flex;align-items:center;gap:1rem;}
		.slider-row input[type=range]{flex:1;accent-color:var(--primary);}
		.slider-val{font-family:'JetBrains Mono',monospace;font-weight:700;font-size:1.1rem;min-width:40px;text-align:center;}
		.options{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:.6rem;margin-top:.5rem;}
		.options label{display:flex;align-items:center;gap:.5rem;font-weight:600;font-size:.9rem;cursor:pointer;}
		.options input[type=checkbox]{accent-color:var(--primary);width:18px;height:18px;}
		input[type=text]{padding:.65rem .9rem;border-radius:var(--radius-sm);border:1px solid var(--border);background:var(--bg-alt);color:var(--text);font-size:.9rem;width:100%;}
		button{padding:.75rem 1.1rem;border-radius:var(--radius-sm);border:none;cursor:pointer;background:linear-gradient(135deg,var(--primary),var(--primary-light));color:#fff;font-weight:700;font-size:.9rem;box-shadow:var(--shadow-sm);transition:transform .15s ease,box-shadow .15s ease;}
		button:hover{transform:translateY(-1px);box-shadow:var(--shadow-md);}
		button.secondary{background:var(--bg-alt);color:var(--text);border:1px solid var(--border);}
		button.secondary:hover{background:var(--border-light);}
		.pw-display{background:var(--bg-alt);border:1px solid var(--border);border-radius:var(--radius-md);padding:1.25rem;font-family:'JetBrains Mono','Cascadia Code',monospace;font-size:1.3rem;word-break:break-all;text-align:center;letter-spacing:.05em;min-height:56px;display:flex;align-items:center;justify-content:center;}
		.strength-bar{height:8px;border-radius:var(--radius-full);background:var(--border);overflow:hidden;margin-top:.5rem;}
		.strength-fill{height:100%;border-radius:var(--radius-full);transition:width .4s,background .4s;width:0;}
		.strength-label{font-weight:700;font-size:.85rem;margin-top:.25rem;}
		.multi-list{list-style:none;display:grid;gap:.4rem;margin-top:.5rem;}
		.multi-list li{background:var(--bg-alt);border:1px solid var(--border);border-radius:var(--radius-sm);padding:.6rem .85rem;font-family:'JetBrains Mono',monospace;font-size:.88rem;display:flex;justify-content:space-between;align-items:center;word-break:break-all;}
		.multi-list li button{padding:.35rem .7rem;font-size:.78rem;}
		h3{font-size:1rem;font-weight:700;margin-bottom:.35rem;}
		.toast{position:fixed;bottom:1.5rem;right:1.5rem;background:var(--primary);color:#fff;padding:.85rem 1.5rem;border-radius:var(--radius-sm);font-weight:600;box-shadow:var(--shadow-lg);transform:translateY(120%);opacity:0;transition:transform .35s var(--ease-bounce,.34 1.56 .64 1),opacity .3s;z-index:9999;pointer-events:none;}
		.toast.show{transform:translateY(0);opacity:1;}
	</style>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
</head>
<body>
<div class="wrap">
	<header>
		<a class="back" href="tools.html"><i class="fas fa-arrow-left"></i> Back to Tools</a>
		<h1><i class="fas fa-key"></i> Password Generator</h1>
		<p class="muted">Generate cryptographically secure passwords with custom rules and strength analysis.</p>
	</header>
	<main>
		<div class="panel">
			<label style="font-weight:600;display:block;margin-bottom:.35rem;">Length</label>
			<div class="slider-row">
				<input type="range" id="length" min="8" max="128" value="16" oninput="lengthChanged()">
				<span class="slider-val" id="lengthVal">16</span>
			</div>

			<div class="options">
				<label><input type="checkbox" id="upper" checked onchange="generate()"> Uppercase (A-Z)</label>
				<label><input type="checkbox" id="lower" checked onchange="generate()"> Lowercase (a-z)</label>
				<label><input type="checkbox" id="nums" checked onchange="generate()"> Numbers (0-9)</label>
				<label><input type="checkbox" id="symbols" checked onchange="generate()"> Symbols (!@#$…)</label>
				<label><input type="checkbox" id="exclude" onchange="generate()"> Exclude ambiguous (0OIl1)</label>
			</div>

			<label style="font-weight:600;display:block;margin-top:.75rem;margin-bottom:.35rem;">Custom characters to include</label>
			<input type="text" id="custom" placeholder="e.g. @#$" oninput="generate()">
		</div>

		<div class="panel">
			<div style="display:flex;justify-content:space-between;align-items:center;">
				<h3>Generated Password</h3>
				<button class="secondary" onclick="copyPw()"><i class="fas fa-copy"></i> Copy</button>
			</div>
			<div class="pw-display" id="pwDisplay">Click Generate</div>
			<div class="strength-bar"><div class="strength-fill" id="strengthFill"></div></div>
			<div class="strength-label" id="strengthLabel" style="color:var(--muted);">—</div>
			<div class="row">
				<button onclick="generate()"><i class="fas fa-sync-alt"></i> Generate</button>
				<button class="secondary" onclick="generateMultiple()"><i class="fas fa-list"></i> Generate 5</button>
			</div>
		</div>

		<!-- Multiple passwords -->
		<div class="panel" id="multiPanel" style="display:none;">
			<h3>Batch Passwords</h3>
			<ul class="multi-list" id="multiList"></ul>
		</div>

		<!-- History -->
		<div class="panel">
			<h3>History (last 5)</h3>
			<ul class="multi-list" id="historyList">
				<li style="color:var(--muted);justify-content:center;">No history yet</li>
			</ul>
		</div>
	</main>
</div>

<div class="toast" id="toast"></div>

<script>
function showToast(msg,ms=2200){
	const t=document.getElementById('toast');t.textContent=msg;t.classList.add('show');
	clearTimeout(t._tid);t._tid=setTimeout(()=>t.classList.remove('show'),ms);
}

const SETS={
	upper:'ABCDEFGHIJKLMNOPQRSTUVWXYZ',
	lower:'abcdefghijklmnopqrstuvwxyz',
	nums:'0123456789',
	symbols:'!@#$%^&*()_-+=[]{}|;:,.<>?/~`'
};
const AMBIGUOUS='0OIl1';
let history=[];

function secureRandom(max){
	const arr=new Uint32Array(1);
	crypto.getRandomValues(arr);
	return arr[0]%max;
}

function lengthChanged(){
	document.getElementById('lengthVal').textContent=document.getElementById('length').value;
	generate();
}

function buildPool(){
	let pool='';
	const enabledSets=[];
	['upper','lower','nums','symbols'].forEach(id=>{
		if(document.getElementById(id).checked){pool+=SETS[id];enabledSets.push(SETS[id]);}
	});
	const custom=document.getElementById('custom').value;
	if(custom) pool+=custom;
	if(document.getElementById('exclude').checked){
		pool=[...pool].filter(c=>!AMBIGUOUS.includes(c)).join('');
		enabledSets.forEach((s,i)=>{enabledSets[i]=[...s].filter(c=>!AMBIGUOUS.includes(c)).join('');});
	}
	return{pool,enabledSets};
}

function makePassword(len){
	const{pool,enabledSets}=buildPool();
	if(!pool){return null;}
	// Guarantee at least one from each enabled set
	let pw=[];
	enabledSets.forEach(s=>{if(s.length) pw.push(s[secureRandom(s.length)]);});
	const remaining=len-pw.length;
	for(let i=0;i<remaining;i++) pw.push(pool[secureRandom(pool.length)]);
	// Shuffle (Fisher-Yates)
	for(let i=pw.length-1;i>0;i--){const j=secureRandom(i+1);[pw[i],pw[j]]=[pw[j],pw[i]];}
	return pw.join('');
}

function calcStrength(pw){
	if(!pw) return{score:0,label:'—',color:'var(--muted)'};
	let poolSize=0;
	if(/[a-z]/.test(pw)) poolSize+=26;
	if(/[A-Z]/.test(pw)) poolSize+=26;
	if(/[0-9]/.test(pw)) poolSize+=10;
	if(/[^a-zA-Z0-9]/.test(pw)) poolSize+=32;
	const entropy=pw.length*Math.log2(poolSize||1);
	if(entropy<36) return{score:20,label:'Weak',color:'var(--error)'};
	if(entropy<60) return{score:40,label:'Fair',color:'var(--warning)'};
	if(entropy<80) return{score:60,label:'Good',color:'#f59e0b'};
	if(entropy<100) return{score:80,label:'Strong',color:'var(--success)'};
	return{score:100,label:'Very Strong',color:'#059669'};
}

function updateStrength(pw){
	const s=calcStrength(pw);
	const fill=document.getElementById('strengthFill');
	const label=document.getElementById('strengthLabel');
	fill.style.width=s.score+'%';
	fill.style.background=s.color;
	label.textContent=s.label;
	label.style.color=s.color;
}

function addToHistory(pw){
	if(!pw) return;
	history.unshift(pw);
	if(history.length>5) history.pop();
	renderHistory();
}

function renderHistory(){
	const ul=document.getElementById('historyList');
	if(!history.length){ul.innerHTML='<li style="color:var(--muted);justify-content:center;">No history yet</li>';return;}
	ul.innerHTML=history.map((p,i)=>`<li><span>${esc(p)}</span><button class="secondary" onclick="copyText('${esc(p)}')"><i class="fas fa-copy"></i></button></li>`).join('');
}

function generate(){
	const len=parseInt(document.getElementById('length').value)||16;
	const pw=makePassword(len);
	if(!pw){document.getElementById('pwDisplay').textContent='Select at least one character set';updateStrength(null);return;}
	document.getElementById('pwDisplay').textContent=pw;
	updateStrength(pw);
	addToHistory(pw);
	showToast('Password generated!');
}

function generateMultiple(){
	const len=parseInt(document.getElementById('length').value)||16;
	const list=[];
	for(let i=0;i<5;i++){
		const pw=makePassword(len);
		if(!pw){showToast('Select at least one character set');return;}
		list.push(pw);
	}
	const panel=document.getElementById('multiPanel');
	panel.style.display='block';
	document.getElementById('multiList').innerHTML=list.map(p=>`<li><span>${esc(p)}</span><button class="secondary" onclick="copyText('${esc(p)}')"><i class="fas fa-copy"></i></button></li>`).join('');
	showToast('5 passwords generated!');
}

function copyPw(){
	const t=document.getElementById('pwDisplay').textContent;
	if(!t||t==='Click Generate'||t.startsWith('Select')){showToast('Nothing to copy');return;}
	navigator.clipboard.writeText(t).then(()=>showToast('Copied to clipboard!'));
}

function copyText(text){
	navigator.clipboard.writeText(text).then(()=>showToast('Copied to clipboard!'));
}

function esc(s){return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/'/g,'&#39;').replace(/"/g,'&quot;');}

// Initial generate
generate();
</script>
<script src="js/global.js"></script>
</body>
</html>
