<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>QR Code Scanner - Multietools</title>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
	<link rel="stylesheet" href="css/global.css">
	<style>
		*{box-sizing:border-box;margin:0;padding:0;}
		body{font-family:'Inter',system-ui,sans-serif;background:var(--bg);color:var(--text);min-height:100vh;padding:1.5rem;transition:background .3s,color .3s;}
		.wrap{max-width:960px;margin:0 auto;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-lg);box-shadow:var(--shadow-md);overflow:hidden;}
		header{padding:1.75rem;border-bottom:1px solid var(--border);background:var(--primary-glow);}
		h1{font-size:1.8rem;margin-bottom:.35rem;} .muted{color:var(--muted);}
		.back{display:inline-flex;align-items:center;gap:.5rem;color:var(--text);text-decoration:none;font-weight:700;margin-bottom:1rem;}
		main{padding:1.5rem;display:grid;gap:1.25rem;}
		.panel{background:var(--surface);border:1px solid var(--border-light);border-radius:var(--radius-md);padding:1.25rem;box-shadow:var(--shadow-xs);}

		label{display:block;font-weight:700;margin-bottom:.4rem;font-size:.92rem;}
		select{width:100%;padding:.75rem .9rem;border-radius:var(--radius-sm);border:1px solid var(--border);background:var(--bg-alt);color:var(--text);font-size:.95rem;font-family:inherit;}
		select:focus{outline:none;border-color:var(--primary);box-shadow:0 0 0 3px var(--primary-glow);}

		.btn{padding:.8rem 1.2rem;border-radius:var(--radius-sm);border:none;cursor:pointer;font-weight:700;font-size:.92rem;display:inline-flex;align-items:center;gap:.5rem;transition:transform .15s,box-shadow .2s;}
		.btn-primary{background:linear-gradient(135deg,var(--primary),var(--primary-light));color:#fff;box-shadow:var(--shadow-sm);}
		.btn-primary:hover{transform:translateY(-1px);box-shadow:var(--shadow-md);}
		.btn-danger{background:var(--error);color:#fff;}
		.btn-danger:hover{opacity:.9;}
		.btn-outline{background:transparent;border:1px solid var(--border);color:var(--text);}
		.btn-outline:hover{border-color:var(--primary);color:var(--primary);}
		.actions{display:flex;gap:.75rem;flex-wrap:wrap;align-items:center;}

		/* Camera */
		.camera-box{position:relative;width:100%;max-width:520px;margin:0 auto;background:#0f0e1a;border-radius:var(--radius-md);overflow:hidden;aspect-ratio:4/3;display:none;}
		.camera-box video{width:100%;height:100%;object-fit:cover;display:block;}
		.scan-overlay{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:220px;height:220px;border:3px solid var(--primary);border-radius:var(--radius-md);box-shadow:0 0 0 9999px rgba(0,0,0,.45);}
		.scan-corner{position:absolute;width:30px;height:30px;border:4px solid var(--secondary);}
		.scan-corner.tl{top:-4px;left:-4px;border-right:none;border-bottom:none;border-radius:4px 0 0 0;}
		.scan-corner.tr{top:-4px;right:-4px;border-left:none;border-bottom:none;border-radius:0 4px 0 0;}
		.scan-corner.bl{bottom:-4px;left:-4px;border-right:none;border-top:none;border-radius:0 0 0 4px;}
		.scan-corner.br{bottom:-4px;right:-4px;border-left:none;border-top:none;border-radius:0 0 4px 0;}

		/* Upload */
		.drop-zone{border:2px dashed var(--border);border-radius:var(--radius-md);padding:2rem;text-align:center;cursor:pointer;transition:border-color .2s,background .2s;color:var(--muted);}
		.drop-zone:hover,.drop-zone.dragover{border-color:var(--primary);background:var(--primary-glow);}
		.drop-zone i{font-size:2rem;margin-bottom:.5rem;display:block;}
		.file-input{display:none;}

		/* Result */
		.result-panel{display:none;background:var(--bg-alt);border:2px solid var(--success);border-radius:var(--radius-md);padding:1.25rem;}
		.result-panel h3{color:var(--success);display:flex;align-items:center;gap:.5rem;margin-bottom:.75rem;}
		.result-text{background:var(--surface);border:1px solid var(--border-light);border-radius:var(--radius-sm);padding:.9rem;font-family:'Courier New',monospace;word-break:break-all;margin-bottom:.75rem;font-size:.95rem;}
		.result-link{color:var(--primary);text-decoration:underline;word-break:break-all;}

		.toast{position:fixed;bottom:2rem;right:2rem;background:var(--primary);color:#fff;padding:.85rem 1.5rem;border-radius:var(--radius-md);font-weight:700;font-size:.92rem;box-shadow:var(--shadow-lg);transform:translateY(120%);opacity:0;transition:transform .35s var(--ease-bounce),opacity .3s;z-index:9999;display:flex;align-items:center;gap:.5rem;}
		.toast.show{transform:translateY(0);opacity:1;}

		.info-box{background:var(--bg-alt);border-left:4px solid var(--primary);border-radius:var(--radius-sm);padding:1rem 1.25rem;color:var(--muted);font-size:.9rem;}
		.info-box h4{color:var(--primary);margin-bottom:.5rem;}
		.info-box ul{margin-left:1.25rem;}
		.info-box li{margin:.35rem 0;}
	</style>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
</head>
<body>
<div class="wrap">
	<header>
		<a class="back" href="tools.html"><i class="fas fa-arrow-left"></i> Back to Tools</a>
		<h1><i class="fas fa-camera"></i> QR Code Scanner</h1>
		<p class="muted">Scan QR codes from your camera or an uploaded image.</p>
	</header>

	<main>
		<!-- Camera section -->
		<div class="panel">
			<div class="actions" style="margin-bottom:1rem;">
				<button class="btn btn-primary" id="start-btn"><i class="fas fa-video"></i> Start Camera</button>
				<button class="btn btn-danger" id="stop-btn" style="display:none;"><i class="fas fa-stop"></i> Stop</button>
				<div style="flex:1;"></div>
				<div style="min-width:180px;" id="cam-select-wrap" hidden>
					<select id="cam-select" style="width:100%;"></select>
				</div>
			</div>
			<div class="camera-box" id="camera-box">
				<video id="video" autoplay playsinline muted></video>
				<div class="scan-overlay">
					<div class="scan-corner tl"></div>
					<div class="scan-corner tr"></div>
					<div class="scan-corner bl"></div>
					<div class="scan-corner br"></div>
				</div>
			</div>
		</div>

		<!-- Upload section -->
		<div class="panel">
			<label><i class="fas fa-upload"></i> Or Upload an Image</label>
			<div class="drop-zone" id="drop-zone">
				<i class="fas fa-cloud-upload-alt"></i>
				<p>Click or drag &amp; drop an image here</p>
			</div>
			<input type="file" id="file-input" class="file-input" accept="image/*">
		</div>

		<!-- Result -->
		<div class="result-panel" id="result-panel">
			<h3><i class="fas fa-check-circle"></i> Scanned Result</h3>
			<div class="result-text" id="result-text"></div>
			<div id="result-link-wrap" style="display:none;margin-bottom:.75rem;">
				<a class="result-link" id="result-link" href="#" target="_blank" rel="noopener"></a>
			</div>
			<div class="actions">
				<button class="btn btn-primary" id="copy-btn"><i class="fas fa-copy"></i> Copy</button>
			</div>
		</div>

		<!-- Info -->
		<div class="info-box">
			<h4><i class="fas fa-info-circle"></i> How to Use</h4>
			<ul>
				<li>Click <strong>Start Camera</strong> and allow camera access</li>
				<li>Point your camera at a QR code â€” it scans automatically</li>
				<li>Or upload / drag an image containing a QR code</li>
				<li>Use the camera selector if you have multiple cameras</li>
			</ul>
		</div>
	</main>
</div>

<div class="toast" id="toast"><i class="fas fa-check-circle"></i> <span id="toast-msg"></span></div>

<script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.js"></script>

<script>
(function(){
	'use strict';

	const video      = document.getElementById('video');
	const cameraBox  = document.getElementById('camera-box');
	const startBtn   = document.getElementById('start-btn');
	const stopBtn    = document.getElementById('stop-btn');
	const camSelect  = document.getElementById('cam-select');
	const camWrap    = document.getElementById('cam-select-wrap');
	const dropZone   = document.getElementById('drop-zone');
	const fileInput  = document.getElementById('file-input');
	const resPanel   = document.getElementById('result-panel');
	const resText    = document.getElementById('result-text');
	const resLink    = document.getElementById('result-link');
	const resLinkW   = document.getElementById('result-link-wrap');
	const copyBtn    = document.getElementById('copy-btn');

	const canvas  = document.createElement('canvas');
	const ctx     = canvas.getContext('2d', { willReadFrequently: true });
	let stream    = null;
	let scanning  = false;
	let animFrame = null;

	/* ---------- Camera list ---------- */
	async function listCameras() {
		try {
			const devices = await navigator.mediaDevices.enumerateDevices();
			const cams = devices.filter(d => d.kind === 'videoinput');
			if (cams.length > 1) {
				camWrap.hidden = false;
				camSelect.innerHTML = cams.map((c, i) =>
					`<option value="${c.deviceId}">${c.label || 'Camera ' + (i+1)}</option>`
				).join('');
			}
		} catch(e) { /* ignore */ }
	}

	/* ---------- Start / Stop camera ---------- */
	async function startCamera() {
		try {
			const constraints = { video: { facingMode: 'environment' } };
			if (camSelect.value) constraints.video = { deviceId: { exact: camSelect.value } };
			stream = await navigator.mediaDevices.getUserMedia(constraints);
			video.srcObject = stream;
			cameraBox.style.display = 'block';
			startBtn.style.display = 'none';
			stopBtn.style.display = 'inline-flex';
			scanning = true;
			await listCameras();
			requestAnimationFrame(tick);
		} catch(e) {
			showToast('Camera access denied');
			console.error(e);
		}
	}

	function stopCamera() {
		scanning = false;
		if (animFrame) cancelAnimationFrame(animFrame);
		if (stream) { stream.getTracks().forEach(t => t.stop()); stream = null; }
		video.srcObject = null;
		cameraBox.style.display = 'none';
		startBtn.style.display = 'inline-flex';
		stopBtn.style.display = 'none';
	}

	function tick() {
		if (!scanning) return;
		if (video.readyState === video.HAVE_ENOUGH_DATA) {
			canvas.width = video.videoWidth;
			canvas.height = video.videoHeight;
			ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
			const imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
			const code = jsQR(imgData.data, imgData.width, imgData.height, { inversionAttempts: 'dontInvert' });
			if (code && code.data) {
				displayResult(code.data);
				stopCamera();
				return;
			}
		}
		animFrame = requestAnimationFrame(tick);
	}

	startBtn.addEventListener('click', startCamera);
	stopBtn.addEventListener('click', stopCamera);
	camSelect.addEventListener('change', () => { stopCamera(); startCamera(); });

	/* ---------- File / Drop ---------- */
	dropZone.addEventListener('click', () => fileInput.click());
	dropZone.addEventListener('dragover', e => { e.preventDefault(); dropZone.classList.add('dragover'); });
	dropZone.addEventListener('dragleave', () => dropZone.classList.remove('dragover'));
	dropZone.addEventListener('drop', e => { e.preventDefault(); dropZone.classList.remove('dragover'); handleFile(e.dataTransfer.files[0]); });
	fileInput.addEventListener('change', () => { if (fileInput.files[0]) handleFile(fileInput.files[0]); });

	function handleFile(file) {
		if (!file || !file.type.startsWith('image/')) { showToast('Please select an image'); return; }
		const reader = new FileReader();
		reader.onload = e => {
			const img = new Image();
			img.onload = () => {
				canvas.width = img.width;
				canvas.height = img.height;
				ctx.drawImage(img, 0, 0);
				const imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
				const code = jsQR(imgData.data, imgData.width, imgData.height);
				if (code && code.data) {
					displayResult(code.data);
				} else {
					showToast('No QR code found in image');
				}
			};
			img.src = e.target.result;
		};
		reader.readAsDataURL(file);
	}

	/* ---------- Result ---------- */
	function displayResult(data) {
		resText.textContent = data;
		resPanel.style.display = 'block';
		const isURL = /^https?:\/\//i.test(data);
		resLinkW.style.display = isURL ? 'block' : 'none';
		if (isURL) { resLink.href = data; resLink.textContent = data; }
		showToast('QR code decoded!');
	}

	copyBtn.addEventListener('click', () => {
		navigator.clipboard.writeText(resText.textContent).then(() => showToast('Copied to clipboard'));
	});

	/* ---------- Toast ---------- */
	let toastTimer;
	function showToast(msg) {
		const toast = document.getElementById('toast');
		document.getElementById('toast-msg').textContent = msg;
		toast.classList.add('show');
		clearTimeout(toastTimer);
		toastTimer = setTimeout(() => toast.classList.remove('show'), 2500);
	}
})();
</script>

<script src="js/global.js"></script>
</body>
</html>
